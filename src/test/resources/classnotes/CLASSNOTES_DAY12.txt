
02/10/2022
----------

API day 12:
	- authentication in API.

	- similar to login into canvas, amazon
	- providing user credentials using API, also providing access tokens
===========================================

What is difference between authentication and authorization?

authentication -> Are you who you say you are. Who are you?
authorization  -> Are you allowed to do this? what rights you have

In API, there are different types of authentication.

1) basic authentication with username and password
2) authentication using tokens. API Keys

When we send a request to API endpoint, most of them will require some sort of authentication.

So we need to learn the type of authentication the API uses and follow that.

SPARTAN API and ORDS APIs so far do not need any authentication, they are open without credentials.

SPARTAN API has a version with basic authentication in port number 7000.
===============================================

SPARTAN API at port number 7000. used basic authentication using username and password.

So whenever we call any method we need to pass credentials together.

http://54.205.239.177:7000/api/spartans

Username: admin
Password: admin

Given accept type is json
and basic auth credentials are "admin" , "admin"
When I send get request to "/api/spartans"
Then status code is 200
and content type is json
And json response should have Spartan list

===============================================

Given accept type is json
and no credentials
When I send get request to "/api/spartans"
Then status code is 401
and content type is json
And json response should have message: Unauthorized

add new package day12_api_authentication

Add new class SpartanWithAuthTest

Add new method
@Test
public void AdmingetAllSpartans() {

}

Vindar Tahir â€” Today at 7:58 PM
Shouldnt we have one more content type in the beginning to make sure it is JSON in the request part of it ?

Not needed, because it is GET request.
We use content type request header with POST, PUT, PATCH requests

===================================================================

Access Tokens -> used API authorization
			  -> they are separately generated by sending request to API endpoint
			  -> After generating Access token, we can use it in other enpoints of API

Access tokens are also called JWT tokens. Json Web Tokens

"token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7ImlkIjoiMTYwIiwiZnVsbF9uYW1lIjoiVGVzdCBTdHVkZW50IDMwIiwiZW1haWwiOiJzdHVkZW50MzBAbGlicmFyeSIsInVzZXJfZ3JvdXBfaWQiOiIzIn0sImlhdCI6MTY0NDU0NDI0NCwiZXhwIjoxNjQ3MTM2MjQ0fQ.4XTTaf8CV3tuufzCq078XS7_xesnVdy91ZJcb7mBjXE"

Now we need to pass this token to other API endpoints of Library application.

Access token is generated using valid credentials. By sending request to a specific API endpoint.

Behind each access token, when decrypted, there is user information.

jwt.io

When we decrypt the token in jwt.io, we get the json value:
{
  "user": {
    "id": "160",
    "full_name": "Test Student 30",
    "email": "student30@library",
    "user_group_id": "3"
  },
  "iat": 1644544244,
  "exp": 1647136244
}

========================

For library Application API, we need to follow 2 steps:

1) send post request to /login with credentials, then read/extract the token
2) add the token to other requests in the application

Add new class LibraryApiAccessTokenTest

/**
	Given accept is json
	and form parameters email and password
	with values "student30@library", "Sdet2022*"
	When i send post request to https://library2.cybertekschool.com/rest/v1/login
	Then status code 200
	And I can extract the access token
*/

@Test
public void getLibraryTokenTest() {

}

How do you use Access tokens in API Testing?

1) Send request to dedicated API endpoint that returns access tokens.
2) I extract that token and pass it in header of other api endpoints.

401 - unauthorized. need token or credentials

